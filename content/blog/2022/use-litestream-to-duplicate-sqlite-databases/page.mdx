export const metadata = {
  title: 'å€Ÿç”± Litestream æ–¹ä¾¿å¤‡ä»½ä½ çš„ SQLite æ•°æ®åº“',
  excerpt: 'åªéœ€æä½çš„æˆæœ¬å°±å¯ä»¥å®ç° SQLite çš„æ•°æ®å®‰å…¨å‚¨å­˜ã€‚',
  publishDate: '2022-06-04T20:23:00.000Z',
  isFeatured: false,
  isGallaryView: false,
  coverImage: 'https://images.unsplash.com/photo-1538474705339-e87de81450e8?ixlib=rb-1.2.1&q=80&cs=tinysrgb&fm=jpg&crop=entropy',
}

SQLite æ•°æ®åº“æœ‰ç€ç®¡ç†ç®€å•ã€åŠŸèƒ½ä¸°å¯Œç­‰ä¼˜ç‚¹ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘éƒ½åå‘äºåœ¨ä¸ªäººé¡¹ç›®æˆ–è€…éƒ¨ç½²å¼€æºé¡¹ç›®æ—¶é€‰æ‹©ä½¿ç”¨ SQLiteï¼Œè€Œä¸æ˜¯ MySQL æˆ–è€… PostgresQLã€‚ è¿™ä¹ˆåšè™½ç„¶å¼€æœºä¸€æ—¶çˆ½ï¼Œä½†æ˜¯æ—¶é—´ä¹…äº†å°±ä¼šåœ¨ä¸åŒæœåŠ¡å™¨çš„ä¸åŒç›®å½•ä¸‹ç•™ä¸‹ä¸€ä¸ªä¸ªæ•°æ®åº“æ–‡ä»¶ã€‚å¦‚ä½•å¤‡ä»½ä»–ä»¬æˆäº†ä¸€ä»¶å¤´ç—›çš„äº‹æƒ…ã€‚


## ä»€ä¹ˆæ˜¯ Litestream


[Litestream](https://litestream.io/)  æ˜¯ä¸€ä¸ªç”¨ Go ç¼–å†™çš„ï¼Œç”¨äº SQLite æ•°æ®åº“çš„æµå¼å¤åˆ¶å·¥å…·ã€‚å®ƒä½œä¸ºä¸€ä¸ªå•ç‹¬çš„åå°è¿›ç¨‹è¿è¡Œï¼Œå¹¶ä¸æ–­åœ°ä»ç£ç›˜ä¸Šå¤åˆ¶å†™å‰æ—¥å¿—é¡µåˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬ã€‚è¿™ç§å¼‚æ­¥å¤åˆ¶æä¾›äº†ç±»ä¼¼äº Postgres æˆ– MySQL ç­‰æ•°æ®åº“æœåŠ¡å™¨çš„ç¾éš¾æ¢å¤ã€‚


SQLite æœ‰ä¸€ä¸ªåä¸º "WAL"ï¼ˆé¢„å†™æ—¥å¿—ï¼‰çš„æ—¥å¿—æ¨¡å¼ã€‚å®ƒé¦–å…ˆå°†æ•°æ®åº“é¡µé¢çš„å˜åŒ–å†™å…¥ä¸€ä¸ªå•ç‹¬çš„ `-wal` æ–‡ä»¶ï¼Œç„¶åå†å°†è¿™äº›é¡µé¢å¤åˆ¶å›ä¸»æ•°æ®åº“æ–‡ä»¶ã€‚è¿™è®© SQLite æä¾›äº†å®‰å…¨çš„åŸå­äº‹åŠ¡ï¼Œå› ä¸ºå¦‚æœä¸€ä¸ªäº‹åŠ¡è¢«å›æ»šï¼Œå®ƒå¯ä»¥ç®€å•åœ°åˆ é™¤ WALã€‚å¦‚æœé¡µé¢ç›´æ¥å†™å…¥æ•°æ®åº“æ–‡ä»¶ï¼Œé‚£ä¹ˆåœ¨å›æ»šæ—¶å°±æ²¡æœ‰åŠæ³•å–å›åŸå§‹çš„é¡µé¢æ•°æ®ã€‚WAL ä¹Ÿå…è®¸è¯»äº‹åŠ¡åœ¨äº‹åŠ¡å¼€å§‹æ—¶æœ‰è‡ªå·±çš„æ•°æ®åº“å¿«ç…§è§†å›¾ï¼Œå› ä¸ºåŒä¸€æ•°æ®åº“é¡µé¢å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹åˆ†å¸ƒåœ¨æ•°æ®åº“æ–‡ä»¶å’Œ WAL ä¸­ã€‚ç„¶è€Œï¼ŒWAL ä¸æ–­å¢é•¿ï¼Œæ‰€ä»¥æœ€ç»ˆé¡µé¢å¿…é¡»è¢«ç§»å›æ•°æ®åº“æ–‡ä»¶ï¼Œä»¥ä¾¿ WAL å¯ä»¥é‡æ–°å¼€å§‹è®°å½•ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸º _æ£€æŸ¥ç‚¹_ï¼Œåªæœ‰åœ¨æ²¡æœ‰äº‹åŠ¡çš„æƒ…å†µä¸‹æ‰èƒ½è¿›è¡Œã€‚è¿™å°±æ˜¯ Litestream å¤åˆ¶ SQLite çš„å…³é”®æ‰€åœ¨ã€‚


> ä¸Šé¢ä¸€æ®µç¿»è¯‘è‡ª Litestream æ–‡æ¡£


Litestream é™¤äº†ä½¿ç”¨ç®€å•çš„ä¼˜ç‚¹ï¼Œå®ƒè¿˜çœé’±ã€‚æˆ‘ç›®å‰æ‰€æœ‰å¤‡ä»½çš„æ•°æ®åº“åŠ èµ·æ¥ä¸åˆ° 500MBï¼Œä¸€ä¸ªæœˆåªéœ€å‡ åç¾åˆ†ï¼ˆé»˜è®¤å¤‡ä»½é¢‘ç‡å’Œå¿«ç…§ç•™å­˜é…ç½®ï¼‰ã€‚


<MDXImage src="./resources/69126b4f.gif" alt="" />


## Getting Started


<Callout icon="ğŸ’¡">æœ¬æ–‡ä»¥ Ubuntu ç³»ç»Ÿä¸ºä¾‹</Callout>


ä¸ºäº†é¿å…æœ¬æ–‡éšæ—¶é—´æ¨ç§»è€Œè¿‡æ—¶ï¼Œè¯·å‚ç…§ [å®˜æ–¹æ–‡æ¡£](https://litestream.io/install/debian/) è¿›è¡Œå®‰è£…ã€‚å®‰è£…å®Œæˆå Litestream ä¾¿ä¼šä»¥å®ˆæŠ¤ç¨‹åºçš„æ–¹å¼éšç³»ç»Ÿå¯åŠ¨ã€‚


å®‰è£…å®Œæˆä¹‹åä½ å°±å¯ä»¥ç¼–è¾‘å®ƒçš„é…ç½®æ–‡ä»¶ `/etc/litestream.yml`ã€‚


```plain text
# AWS credentials
access-key-id:     AKIAxxxxxxxxxxxxxxxx
secret-access-key: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/xxxxxxxxx

dbs:
  - path: /srv/docker/app-1/db.sqlite
    replicas:
      - type: s3
        bucket: litestream-us-west-1
        path: app-1
        region: us-west-1
  - path: /srv/docker/app-2/db.sqlite
    replicas:
      - type: s3
        bucket: litestream-us-west-1
        path: app-2
        region: us-west-1

```


- å…³äºé…ç½®æ–‡ä»¶å®Œæ•´çš„è§£é‡Šè¯·çœ‹ [è¿™é‡Œ](https://litestream.io/reference/config/)ã€‚

- [å¦‚ä½•åˆ›å»ºä¸€ä¸ª S3 å‚¨å­˜åº“å¹¶å®‰å…¨åœ°å­˜å–](https://litestream.io/guides/s3/)

ç¼–è¾‘ç»“æŸåå°±å¯ä»¥é‡å¯ Litestreamã€‚


```plain text
$ sudo systemctl restart litestream

$ litestream databases
path                                 replicas
/srv/docker/app-1/db.sqlite          s3
/srv/docker/app-2/db.sqlite          s3

```


æˆåŠŸï¼


<MDXImage src="./resources/dee009c0.gif" alt="" />


## å¦‚ä½•æ¢å¤


```plain text
# æ¢å¤åˆ°æœ€è¿‘ä¸€ä¸ªå‰¯æœ¬
$ litestream restore /srv/docker/app-1/db.sqlite

# æ¢å¤æœ€è¿‘ä¸€ä¸ªå‰¯æœ¬åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶
$ litestream restore -o ./db.sqlite /srv/docker/app-1/db.sqlite

# æ¢å¤åˆ°æ—¶é—´ç‚¹
$ litestream restore -timestamp 2020-01-01T00:00:00Z /srv/docker/app-1/db.sqlite

```


- [æ–‡æ¡£](https://litestream.io/reference/restore/)
