export const metadata = {
  title: 'è®© Tailscale MagicDNS å’Œ Surge å…±å­˜',
  excerpt: 'Surge å’Œ Tailscale å› ä¸ºåŒä¸ºç½‘ç»œå·¥å…·å­˜åœ¨äº’ç›¸å†²çªçš„æƒ…å†µï¼Œä¸€ç›´ä»¥æ¥æˆ‘éƒ½ä¸å¾—ä¸å…³é—­ Tailscale çš„æŸäº›åŠŸèƒ½ä½¿å…¶å·¥ä½œã€‚è¿™ç¯‡æ–‡ç« è¯•å›¾ä½¿ç”¨ä¸€äº›ç‰¹æ®Šæ–¹æ³•ç»•è¿‡é™åˆ¶ï¼Œè®© Tailscale  MagicDNS å’Œ Surge å…±å­˜ã€‚',
  publishDate: '2024-06-01T09:30:00.000Z',
  isFeatured: false,
  isGalleryView: false,
}

Surge å’Œ Tailscale å› ä¸ºåŒä¸ºç½‘ç»œå·¥å…·å­˜åœ¨äº’ç›¸å†²çªçš„æƒ…å†µï¼Œä¸€ç›´ä»¥æ¥æˆ‘éƒ½ä¸å¾—ä¸å…³é—­ Tailscale çš„æŸäº›åŠŸèƒ½ä½¿å…¶å·¥ä½œã€‚è¿™ç¯‡æ–‡ç« è¯•å›¾ä½¿ç”¨ä¸€äº›ç‰¹æ®Šæ–¹æ³•ç»•è¿‡é™åˆ¶ï¼Œè®© Tailscale  MagicDNS å’Œ Surge å…±å­˜ã€‚


<Callout icon="ğŸ’¡">@Blankwonder å®¡é˜…è¿™ç¯‡æ–‡ç« åæ›´æ–°äº† Surge for Macï¼Œç°åœ¨å·²ç»èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ `<machine name>.<tailnet name>.ts.net` åŸŸåï¼Œå¦‚æœä½ æƒ³çœç•¥ `<tailnet name>` å¯ä»¥ç»§ç»­å¾€ä¸‹è¯»ã€‚</Callout>


## ä»€ä¹ˆæ˜¯ Tailscale MagicDNS


> Tailscale can automatically assign DNS names for devices in your network when you use the [**MagicDNS**](https://tailscale.com/kb/1054/dns) feature.

<LinkPreview url="https://tailscale.com/kb/1054/dns" />

Tailnet å†…çš„è®¾å¤‡ä¼šè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ `100.64.0.0/10` åœ°å€ã€‚ä½ å¯ä»¥ç›´æ¥è®¿é—®è¿™ä¸ª IP åœ°å€ï¼Œä½†æ˜¯æ­£å¦‚ç›´æ¥ä½¿ç”¨ IP ç½‘ä¸Šå†²æµªæ˜¯ä¸ªåä¸»æ„ï¼Œç›´æ¥ä½¿ç”¨ IP ä¹Ÿä¸æ˜¯ä¸ªå¥½ä¸»æ„ã€‚æ‰€ä»¥ Tailscale ä¼šä¸ºæ¯ä¸ª IP ä¹Ÿåˆ†é…ä¸€ä¸ª [`ts.net`](http://ts.net/) çš„åœ°å€ã€‚


è¿™ä¸ªåŸŸåå¹¶éå…¬ç½‘ DNS èƒ½å¤Ÿè§£æï¼Œè€Œæ˜¯ç”± Tailnet å†… `100.100.100.100` è¿™ä¸ª DNS æœåŠ¡å™¨è§£æçš„ã€‚è¿™ä¸€ DNS æœåŠ¡åå« MagicDNSã€‚


<MDXImage src="./resources/9ffe8c53.png" alt="" />


å¦‚å›¾ï¼Œä½ åªéœ€è¦è®°å¾— machine nameï¼Œå¹¶ä¸”å¼€å¯ Tailscale MagicDNSï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ `https://monitoring` å°±ç›¸å½“äºè®¿é—® `https://onitoring.yak-bebop.ts.net:443` ã€‚


## é—®é¢˜


å½“ Tailscale å¯åŠ¨æ—¶å®ƒä¼šåœ¨è·¯ç”±è¡¨ä¸­å†™å…¥ä¸‹é¢çš„å†…å®¹ï¼Œå‘Šè¯‰ç³»ç»Ÿé‡åˆ°è¿™äº› IP çš„è¯·æ±‚å°±äº¤ç»™ Tailscale çš„ utun æ¥å£ã€‚


```plain text
Destination        Gateway            Flags               Netif Expire
100.64/10          link#37            UCS                 utun9
100.100.100.100    link#37            UHWIi               utun9
```


ç„¶è€Œå½“ Surge çš„é«˜çº§æ¨¡å¼å¼€å¯æ—¶ï¼ŒSurge å¤„äºæŸç§åŸå› æ— æ³•å°† DNS æŸ¥è¯¢çš„æ•°æ®åŒ…å‘å¾€ utun9ï¼Œå³ä¾¿ä½ åœ¨è§„åˆ™ä¸­å†™äº†è¿™æ ·çš„è§„åˆ™ã€‚


```plain text
[Proxy]
Tailscale = DIRECT, interface = utun9

[Host]
*.ts.net = server:100.100.100.100

[Rule]
IP-CIDR,100.64.0.0/10,Tailscale,no-resolve
```


è¿™ä¸ªé™åˆ¶ä¼¼ä¹å¹¶ä¸å‘ç”Ÿåœ¨ TCP è¯·æ±‚ï¼Œå› ä¸ºåé¢çš„è§£å†³æ–¹æ¡ˆæ— éœ€åŠ å…¥è¿™äº›çš„è§„åˆ™ã€‚


<Callout icon="ğŸ’¡">è¿™ä¸ªé—®é¢˜åœ¨æ–°ç‰ˆçš„ Surge for Mac ä¸­å·²ç»å¾—åˆ°è§£å†³</Callout>


## è§£å†³


æˆ‘åœ¨æµè§ˆ Tailscale æ–‡æ¡£æ—¶å‘ç°ï¼Œä»–ä»¬æä¾›äº† API æ¥å£æ¥è·å–æ‰€æœ‰çš„å®ä¾‹åç§°å’Œåœ°å€ï¼Œè¿™æ ·å°±èƒ½è‡ªå·±å®ç°ä¸€ä¸ª DNS è§£æã€‚ä¸‹é¢æ˜¯è„šæœ¬å†…å®¹ã€‚


<Callout icon="âš ï¸">å¦‚æœä½ åŠ å…¥äº†å¤šä¸ª Tailnetï¼Œè¿™ä¸ªè„šæœ¬å¹¶ä¸é€‚ç”¨ï¼</Callout>


```javascript
const TENANT_ID = "TENANT_ID";
const TAILNET_NAME = "<NAME>.ts.net";
const ACCESS_KEY = "YOU_KEY";

(async () => {
  $httpClient.get(
    {
      url: `https://api.tailscale.com/api/v2/tailnet/${TENANT_ID}/devices?fields=default`,
      headers: {
        Authorization: `Bearer ${ACCESS_KEY}`,
      },
    },
    function (error, response, data) {
      if (error) {
        $done({});
        return;
      }

      data = JSON.parse(data);

      for (const device of data.devices) {
        const { addresses, name } = device;

        if (
          name === $domain ||
          name.replace(TAILNET_NAME, "ts.net") === $domain
        ) {
          return $done({ addresses, ttl: 2629746 });
        }
      }

      $done({});
    }
  );
})();
```


ä½¿ç”¨è„šæœ¬ä¹‹å‰ï¼Œä½ éœ€è¦å‡†å¤‡ä¸‰ä¸ªå­—æ®µï¼š


- `TENANT_ID`

<MDXImage src="./resources/37087123.png" alt="" />


- `TAILNET_NAME` - ä½ å¯ä»¥åœ¨ [è¿™é‡Œ](https://login.tailscale.com/admin/dns) æ‰¾åˆ°ï¼Œå¡«å…¥åŒ…å« `ts.net` çš„åç§°

- `ACCESS_KEY` - ä½ å¯ä»¥åœ¨ [è¿™é‡Œ](https://login.tailscale.com/admin/settings/keys) ç”³è¯·  **API access tokens**ï¼Œæœ‰æ•ˆæœŸæœ€é•¿ 90 å¤©

## ä½¿ç”¨


```plain text
[Host]
*.<tailnet name>.ts.net = server:100.100.100.100
*.ts.net = script:tailscale-dns

[Script]
tailscale-dns = script-path=tailscale-dns.js,type=dns,debug=false,engine=jsc
```


æ¥ä¸‹æ¥ä½ ä¾¿å¯ä»¥ä½¿ç”¨ `<machine name>.ts.net` æ¥è¿æ¥å¯¹åº”çš„ä¸»æœºå®ä¾‹ã€‚


è¿™ä¸ªæ–¹æ¡ˆæ— æ³•å®ç° search domains æ‰€ä»¥ä½ è‡³å°‘éœ€è¦å†™ä¸Š [`ts.net`](http://ts.net/)ã€‚ç”±äºæˆ‘ä¸è€ƒè™‘å¤šä¸ª Tailnet çš„æƒ…å†µï¼Œä¹Ÿä¸éœ€è¦è®°ä½ä½  Tailnet çš„åç§°ã€‚


### æ³¨æ„


1. è„šæœ¬çš„ Key åªæœ‰ 90 å¤©æœ‰æ•ˆæœŸï¼Œä½ éœ€è¦å®šæœŸæ›´æ–°
2. æ¯æ¬¡è®¿é—® `*.ts.net` åªè¦åŸŸåè§£ææœªè¿‡æœŸéƒ½ä¼šå‘èµ·ä¸€æ¬¡è¯·æ±‚ï¼Œé€šå¸¸è¿™ä¸æ˜¯é—®é¢˜ï¼Œå¦‚æœä½ é‡åˆ°äº†é—®é¢˜å¯ä»¥åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘
